<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Console Capture - Pixel8 Debug</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: #fff;
        }
        #console-output {
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .log-info { color: #60a5fa; }
        .log-warn { color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .log-error { color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        .log-debug { color: #10b981; }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            margin: 20px 0;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <h1>üîç Pixel8 Browser Console Capture</h1>
    
    <button onclick="captureConsole()">üìã Capture Console Output</button>
    <button onclick="clearConsole()">üóëÔ∏è Clear Output</button>
    <button onclick="reloadApp()">üîÑ Reload App</button>
    
    <div id="console-output">
        <div class="log-entry log-info">Console capture initialized. Loading app...</div>
    </div>
    
    <iframe id="app-frame" src="http://localhost:4173"></iframe>
    
    <script>
        let consoleOutput = document.getElementById('console-output');
        let appFrame = document.getElementById('app-frame');
        let logs = [];
        
        // Override console methods to capture output
        const originalConsole = {
            log: console.log,
            warn: console.warn,
            error: console.error,
            info: console.info,
            debug: console.debug
        };
        
        function addLogEntry(type, message, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const entry = {
                timestamp,
                type,
                message: String(message),
                args: args.map(arg => String(arg))
            };
            
            logs.push(entry);
            
            const logElement = document.createElement('div');
            logElement.className = `log-entry log-${type}`;
            logElement.innerHTML = `
                <span style="opacity: 0.7">[${timestamp}]</span> 
                <strong>${type.toUpperCase()}:</strong> 
                ${entry.message} ${entry.args.join(' ')}
            `;
            
            consoleOutput.appendChild(logElement);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // Call original console method
            originalConsole[type](message, ...args);
        }
        
        // Override console methods
        console.log = (...args) => addLogEntry('info', ...args);
        console.warn = (...args) => addLogEntry('warn', ...args);
        console.error = (...args) => addLogEntry('error', ...args);
        console.info = (...args) => addLogEntry('info', ...args);
        console.debug = (...args) => addLogEntry('debug', ...args);
        
        // Capture window errors
        window.addEventListener('error', (e) => {
            addLogEntry('error', `Global Error: ${e.message}`, `at ${e.filename}:${e.lineno}:${e.colno}`);
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            addLogEntry('error', `Unhandled Promise Rejection:`, e.reason);
        });
        
        // Try to access iframe console (if CORS allows)
        appFrame.onload = function() {
            try {
                const frameWindow = appFrame.contentWindow;
                if (frameWindow) {
                    // Override console in iframe
                    frameWindow.console.log = (...args) => addLogEntry('info', '[IFRAME]', ...args);
                    frameWindow.console.warn = (...args) => addLogEntry('warn', '[IFRAME]', ...args);
                    frameWindow.console.error = (...args) => addLogEntry('error', '[IFRAME]', ...args);
                    
                    addLogEntry('info', 'Successfully hooked into iframe console');
                }
            } catch (e) {
                addLogEntry('warn', 'Cannot access iframe console (CORS restriction):', e.message);
                
                // Alternative: Monitor iframe for changes
                monitorIframeChanges();
            }
        };
        
        function monitorIframeChanges() {
            let lastContent = '';
            const checkInterval = setInterval(() => {
                try {
                    const frameDoc = appFrame.contentDocument || appFrame.contentWindow.document;
                    const currentContent = frameDoc.body.innerHTML;
                    
                    if (currentContent !== lastContent) {
                        if (currentContent.includes('Loading React application')) {
                            addLogEntry('warn', 'App still stuck on loading screen');
                        } else if (currentContent.includes('App Initialization Timeout')) {
                            addLogEntry('error', 'App initialization timeout triggered');
                            clearInterval(checkInterval);
                        } else if (currentContent.includes('Application Error')) {
                            addLogEntry('error', 'Application error boundary triggered');
                            clearInterval(checkInterval);
                        } else if (!currentContent.includes('loading-screen')) {
                            addLogEntry('info', 'App successfully loaded and replaced loading screen!');
                            clearInterval(checkInterval);
                        }
                        lastContent = currentContent;
                    }
                } catch (e) {
                    // CORS prevents access, that's expected
                }
            }, 1000);
            
            // Stop monitoring after 30 seconds
            setTimeout(() => {
                clearInterval(checkInterval);
                addLogEntry('info', 'Stopped monitoring iframe changes');
            }, 30000);
        }
        
        function captureConsole() {
            const summary = {
                totalLogs: logs.length,
                errors: logs.filter(l => l.type === 'error').length,
                warnings: logs.filter(l => l.type === 'warn').length,
                infos: logs.filter(l => l.type === 'info').length,
                recentErrors: logs.filter(l => l.type === 'error').slice(-5),
                recentWarnings: logs.filter(l => l.type === 'warn').slice(-5)
            };
            
            addLogEntry('info', '=== CONSOLE CAPTURE SUMMARY ===');
            addLogEntry('info', `Total Logs: ${summary.totalLogs}`);
            addLogEntry('info', `Errors: ${summary.errors}, Warnings: ${summary.warnings}, Info: ${summary.infos}`);
            
            if (summary.recentErrors.length > 0) {
                addLogEntry('error', 'Recent Errors:');
                summary.recentErrors.forEach(err => {
                    addLogEntry('error', `- ${err.message} ${err.args.join(' ')}`);
                });
            }
            
            if (summary.recentWarnings.length > 0) {
                addLogEntry('warn', 'Recent Warnings:');
                summary.recentWarnings.forEach(warn => {
                    addLogEntry('warn', `- ${warn.message} ${warn.args.join(' ')}`);
                });
            }
        }
        
        function clearConsole() {
            consoleOutput.innerHTML = '<div class="log-entry log-info">Console cleared.</div>';
            logs = [];
        }
        
        function reloadApp() {
            addLogEntry('info', 'Reloading app iframe...');
            appFrame.src = appFrame.src;
        }
        
        // Initial load message
        addLogEntry('info', 'Browser console capture ready. Loading Pixel8 app...');
        
        // Log browser info
        addLogEntry('debug', `User Agent: ${navigator.userAgent}`);
        addLogEntry('debug', `App URL: ${appFrame.src}`);
    </script>
</body>
</html>